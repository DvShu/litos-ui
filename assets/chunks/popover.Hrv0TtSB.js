var C=Object.defineProperty;var O=(i,t,e)=>t in i?C(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var c=(i,t,e)=>O(i,typeof t!="symbol"?t+"":t,e);import{$ as g,b as _,i as E,o as a,a as v,s as M,c as w}from"./dom.DntxtiBs.js";function b(i,t,e,o,n=10,r="x"){const s=r==="x"?"width":"height";let p=["left","right","top","bottom"];r==="y"&&(p=["top","bottom","left","right"]);let h=0;return e===p[0]?h=t[s]+n:e===p[1]?h=-(i[s]+n):(e===p[2]||e===p[3])&&(o===""?h=t[s]/2-i[s]/2:o==="end"&&(h=t[s]-i[s])),h}function L(i){const t=[];let e=i;for(;e&&e!==document.body&&e!==document.documentElement;){const o=window.getComputedStyle(e),n=o.overflow+o.overflowX+o.overflowY;/(scroll|auto)/i.test(n)&&t.push(e),e=e.parentElement}return t}function R(i,t,e,o,n=10){let r=document.documentElement;const s=r.scrollLeft,p=r.scrollTop,h=window.innerHeight+p-10,l=window.innerWidth+s-10;let d=b(i,t,e,o,n,"y"),f=i.top+p-d;f+t.height>h&&(e==="left"||e==="right"?o="end":e="top"),f<p&&(e==="left"||e==="right"?o="start":e="bottom");let m=b(i,t,e,o,n,"x"),$=i.left+s-m;$+t.width>l&&(e==="top"||e==="bottom"?o="end":e="left"),$<s&&(e==="top"||e==="bottom"?o="start":e="right"),d=b(i,t,e,o,n,"y"),m=b(i,t,e,o,n,"x"),$=i.left+s-m,f=i.top+p-d;const P=`${e}${o===""?"":"-"+o}`;return{x:$,y:f,mainAlign:e,crossAlign:o,placement:P}}function z(i,t,e,o){const n=i.getBoundingClientRect(),r=t.getBoundingClientRect();let s="height";(e==="top"||e==="bottom")&&(s="width");const p=Math.min(n[s],r[s]);let h=0;return o==="start"?h=p/2-4:o==="end"?h=r[s]-p/2-4:h=r[s]/2-4,{x:s==="width"?h:void 0,y:s==="height"?h:void 0}}function y(i,t,e={placement:"top",offset:10,arrowSize:8}){let o="bottom",n="";const r=(e.placement||"top").split("-");r!=null&&(o=r[0],n=r[1]||"");let s,p=t.getBoundingClientRect();const h=i.getBoundingClientRect();e.popoverWidth&&(e.popoverWidth==="trigger"?s=h.width:s=e.popoverWidth),s!=null&&(p.width=s,t.style.width=`${s}px`);const l=R(h,p,o,n,e.offset||10);t.style.setProperty("left",`${l.x}px`),t.style.setProperty("top",`${l.y}px`);let d=g(".l-popover-arrow",t);if(d){const f=z(i,t,l.mainAlign,l.crossAlign);let u="";e.arrowSize!==8&&(u+=`--l-popover-arrow-size: ${e.arrowSize}px;`),f.x&&(u+=`left: ${f.x}px;`),f.y&&(u+=`top: ${f.y}px;`);const m={top:"bottom",right:"left",bottom:"top",left:"right"}[l.mainAlign],$={top:"right",bottom:"left",left:"top",right:"bottom"}[l.mainAlign],x=Math.ceil((e.arrowSize||8)/2);u+=`${m}: -${x}px;border-${m}: 1px solid var(--l-popover-border-color);border-${$}:1px solid var(--l-popover-border-color);`,d.style.cssText=u}}function S(i,t,e){let o=i,n=t,r=e;y(o,n,r);function s(){y(o,n,r)}let p=L(o);p.forEach(f=>{a(f,"scroll",s)});function h(){y(o,n,r)}let l=new ResizeObserver(h);l.observe(o),l.observe(window.document.body);function d(){p.forEach(f=>{v(f,"scroll",s)}),p=void 0,o=void 0,n=void 0,r=void 0,l.disconnect(),l=void 0}return{destroy:d}}class W{constructor(t){c(this,"options");c(this,"$refs",[]);c(this,"$reference");c(this,"popoverElement");c(this,"updater");c(this,"_hideTimer");c(this,"_onPopoverEnter",()=>{this._clearHideTimer()});c(this,"_onMouseEnter",t=>{const e=t.target;this._clearHideTimer(),this.$reference!=e&&this.show(e)});c(this,"_onMouseLeave",()=>{this._clearHideTimer(),this.options.trigger==="hover"&&(this._hideTimer=setTimeout(()=>{this.hide()},50))});c(this,"_onRefTap",t=>{this._destroyUpdater();const e=t.target;if(this.$reference){if(this.options.trigger==="focus")return;this.hide();return}this.show(e)});c(this,"_onOuterTap",t=>{const e=t.target;if(this.$reference&&!this.$reference.contains(e)&&this.$reference!=e){if(this.options.trigger==="focus"){this.hide();return}if(this.popoverElement&&(this.popoverElement.contains(e)||this.popoverElement==e)){const[o,n,r]=M(t,"data-action",this.popoverElement);if(o){let s="";n==="popconfirm-cancel"?s="cancel":n==="popconfirm-ok"&&(s="ok"),s&&this.hide(),this.options.onPopoverAction&&this.options.onPopoverAction(s||n,r)}return}this.hide()}});this.options={trigger:"hover",arrow:!0,offset:10,arrowSize:8,disabled:!1,updateContent:(o,n)=>{if(n&&n.title){const r=g(".l-popover-content",o);r&&(r.textContent=n.title)}},...t};let e=[];this.options.reference?typeof this.options.reference=="string"?e=[..._(this.options.reference)]:Array.isArray(this.options.reference)?e.push(...this.options.reference):e.push(this.options.reference):e=[..._(".l-popover-reference")],this.$refs=e,this.popoverElement=this.options.popover,this._bindPopoverEvents(),this._init()}addReference(t){this.$refs&&(this._bindReferenceEvents(t),this.$refs.push(t))}removeReference(t){if(this.$refs){let e=this.$refs.indexOf(t);e!==-1&&(t==this.$reference&&this.hide(),this._removeReferenceEvents(t),this.$refs.splice(e,1))}}_init(){this.options.trigger&&this.$refs&&E(this.$refs,t=>{this._bindReferenceEvents(t)}),a(document,"click",this._onOuterTap,{capture:!0})}_bindReferenceEvents(t){const e=this.options.trigger;["click","focus"].includes(e)?a(t,"click",this._onRefTap):e==="hover"&&(a(t,"mouseenter",this._onMouseEnter),a(t,"mouseleave",this._onMouseLeave))}_removeReferenceEvents(t){v(t,"click",this._onRefTap),v(t,"mouseenter",this._onMouseEnter),v(t,"mouseleave",this._onMouseLeave)}_bindPopoverEvents(){this.popoverElement&&this.options.trigger==="hover"&&(a(this.popoverElement,"mouseenter",this._onPopoverEnter),a(this.popoverElement,"mouseleave",this._onMouseLeave))}_clearHideTimer(){this._hideTimer&&(clearTimeout(this._hideTimer),this._hideTimer=void 0)}show(t){const e=t.dataset;let o=e.disabled;if(o==null&&(o=this.options.disabled),!o){if(this.$reference){if(this.$reference===t)return;this.hide()}if(this.$reference=t,this.popoverElement||(this._renderPopover(),this._bindPopoverEvents()),this.popoverElement){this.options.updateContent&&this.options.updateContent(this.popoverElement,e),this._destroyUpdater();const n=e.placement||this.options.placement||"top",r=Number(e.offset||this.options.offset||10),s=e.popoverWidth||this.options.popoverWidth;this.popoverElement.style.display="block";let p;s&&(s!=="trigger"?p=Number(s):p=s),this.updater=S(this.$reference,this.popoverElement,{placement:n,popoverWidth:p,offset:r,arrowSize:this.options.arrowSize}),this.options.onOpenChange&&this.options.onOpenChange(!0)}}}isShow(){return this.$reference!=null}hide(){this._destroyUpdater(),this.popoverElement&&(this.popoverElement.style.display="none"),this.$reference=void 0,this.options.onOpenChange&&this.options.onOpenChange(!1)}setOption(t,e){this.options[t]=e}updatePopoverContent(){this.popoverElement&&this.options.updateContent&&this.options.updateContent(this.popoverElement,{})}_renderPopover(){let e=`l-popover l-popover--${this.options.theme||"default"}`;this.options.popoverClass&&(e+=` ${this.options.popoverClass}`);const o=w("div",{class:e}),n=this.options.contentRender;if(n){const r=n();typeof r=="string"?o.innerHTML=r:o.appendChild(r)}else{const r=w("div",{class:"l-popover-content"});o.appendChild(r)}this.options.arrow&&o.appendChild(w("div",{class:"l-popover-arrow"})),document.body.appendChild(o),this.popoverElement=o}_destroyUpdater(){this.updater&&(this.updater.destroy(),this.updater=void 0)}destroy(){this.hide(),this.$refs&&E(this.$refs,t=>{this._removeReferenceEvents(t)}),v(document,"click",this._onOuterTap,{capture:!0}),this.options=void 0,this.$refs=void 0,this._clearHideTimer(),this.popoverElement&&(v(this.popoverElement,"mouseenter",this._onPopoverEnter),v(this.popoverElement,"mouseleave",this._onMouseLeave),this.popoverElement.remove()),this.popoverElement=void 0}}const B={theme:"popconfirm",trigger:"click",contentRender:()=>{const i=[];return i.push('<div class="l-popconfirm-container">'),i.push('<div class="l-popconfirm-icon-wrapper">'),i.push("<l-warn-icon></l-warn-icon>"),i.push('</div><div class="l-popconfirm-content"></div></div>'),i.push('<div class="l-popconfirm-footer">'),i.push('<l-button class="l-popconfirm-btn" data-action="popconfirm-cancel">取消</l-button>'),i.push('<l-button class="l-popconfirm-btn" type="primary" data-action="popconfirm-ok">确定</l-button>'),i.push("</div>"),i.join("")},updateContent:(i,t)=>{const e=i.querySelector(".l-popconfirm-content");e&&t&&(e.innerHTML=t.content||"")}};function T(i,t){return i.classList.contains(t)?i:_(`.${t}`,i)}function N(i,t,e){let o=new MutationObserver(n=>{n.forEach(r=>{r.type==="childList"&&(E(r.addedNodes,s=>{let p=T(s,t);p&&(p instanceof HTMLElement?e.addReference(p):E(p,h=>{e.addReference(h)}))}),E(r.removedNodes,s=>{let p=T(s,t);p&&(p instanceof HTMLElement?e.removeReference(p):E(p,h=>{e.removeReference(h)}))}))})});return o.observe(i,{childList:!0,subtree:!0}),o}export{W as P,S as a,N as c,L as g,B as p,y as u};
